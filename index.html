<!DOCTYPE html>
<html>
<head>
    <title>Tracking Board Outbound</title>
    <style>
        /* Estilo base do corpo da página */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            text-align: center;
        }

        /* Estilização do título principal com sombra e fundo */
        h1 {
            font-size: 4.5em;
            font-weight: bold;
            margin: 0px 0;
            color: white;
            text-shadow: 4px 4px 8px rgba(0, 0, 139, 0.6), 0 0 10px rgba(0, 0, 139, 0.4);
            background-color: #0b1b44;
            padding: 30px;
        }

        /* Container para os botões de aba */
        .tab-buttons {
            margin-top: 20px;
            margin-bottom: 5px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* Estilo base dos botões de aba */
        .tab-button {
            padding: 10px 100px;
            font-size: 14px;
            background-color: white;
            color: #0b1b44;
            border: 2px solid #0b1b44;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Efeito hover nos botões */
        .tab-button:hover {
            background-color: #1a2f6f;
            color: white;
        }

        /* Estilo do botão ativo */
        .tab-button.active {
            background-color: #0b1b44;
            color: white;
            font-weight: bold;
        }

        /* Botão de alternância do timer */
        .toggle-timer {
            position: absolute;
            right: 10px;
            padding: 5px 15px;
            font-size: 12px;
            background-color: white;
            color: #0b1b44;
            border: 2px solid #0b1b44;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Efeitos do botão de timer */
        .toggle-timer:hover {
            background-color: #1a2f6f;
            color: white;
        }

        .toggle-timer.active {
            background-color: #0b1b44;
            color: white;
            font-weight: bold;
        }

        /* Estilo do conteúdo das abas com animação de fade */
        .tab-content {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .tab-content.active {
            display: block;
            opacity: 1;
        }

        /* Estilização da tabela */
        table {
            width: 99%; /* Largura quase total da página */
            border-collapse: collapse;
            margin: 20px auto;
            table-layout: fixed;
        }

        /* Estilo das células da tabela */
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Cabeçalho da tabela */
        tr:first-child {
            background-color: #0b1b44;
            color: white;
            font-weight: bold;
        }

        /* Linhas alternadas da tabela */
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Timer oculto por padrão */
        #timer {
            display: none;
        }
    </style>
    <script>
        // Variáveis globais para controle de estado
        let lastDataPA = null;          // Armazena últimos dados da tabela PA
        let lastDataFabrica = null;     // Armazena últimos dados da tabela Fábrica
        let countdown = 15;             // Contador para atualização
        let currentTab = "embarquesPA"; // Controle da aba atual
        let timerActive = false;        // Estado do timer de alternância
        let timerInterval = null;       // Referência do intervalo de alternância

        // Formata data para padrão DD/MM/YY
        function formatDate(dateString) {
            if (!dateString.includes('T')) return dateString;

            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear().toString().slice(-2);
            return `${day}/${month}/${year}`;
        }

        // Verifica se a data é hoje
        function isToday(dateString) {
            if (!dateString.includes('T')) return false;

            const date = new Date(dateString);
            const today = new Date();
            return date.getDate() === today.getDate() &&
                date.getMonth() === today.getMonth() &&
                date.getFullYear() === today.getFullYear();
        }

        // Determina se uma linha deve ser exibida baseado na data e hora de liberação
        function shouldShowRow(row, headerRow) {
            if (isToday(row[0])) return true;

            const liberacaoIndex = headerRow.findIndex(header => header.includes("HORA DE LIBERAÇÃO"));
            if (liberacaoIndex === -1) return false;

            return !row[liberacaoIndex] || row[liberacaoIndex].trim() === '';
        }

        // Compara arrays para verificar se houve mudança nos dados
        function areArraysEqual(arr1, arr2) {
            if (!arr1 || !arr2) return false;
            return JSON.stringify(arr1) === JSON.stringify(arr2);
        }

        // Atualiza a tabela com novos dados
        function updateTable(tableId, newData, lastData) {
            if (areArraysEqual(newData, lastData)) {
                return lastData;
            }

            const table = document.getElementById(tableId);
            table.innerHTML = '';

            if (newData.length === 0) return lastData;

            // Cria cabeçalho da tabela
            let headerRow = document.createElement("tr");
            newData[0].forEach(cell => {
                let td = document.createElement("td");
                td.innerText = cell;
                headerRow.appendChild(td);
            });
            table.appendChild(headerRow);

            // Preenche dados da tabela
            newData.slice(1).forEach(row => {
                if (shouldShowRow(row, newData[0])) {
                    let tr = document.createElement("tr");
                    row.forEach((cell, index) => {
                        let td = document.createElement("td");
                        td.innerText = index === 0 ? formatDate(cell) : cell || '';
                        tr.appendChild(td);
                    });
                    table.appendChild(tr);
                }
            });

            return newData;
        }

        // Busca dados da API do Google Sheets
        function fetchData() {
            fetch('https://script.google.com/macros/s/AKfycbyT7wTm2r9jGnyXi9GzbZTlefMZTh3lz9TIJU8cbczskRZJMjLkS_zw8zFd4hH-3AR0/exec')
                .then(response => response.json())
                .then(data => {
                    lastDataPA = updateTable("tablePA", data.EMBARQUES_PA, lastDataPA);
                    lastDataFabrica = updateTable("tableFabrica", data.EMBARQUES_FABRICA, lastDataFabrica);
                })
                .catch(error => console.error('Erro ao carregar os dados: ', error));
        }

        // Alterna entre as abas
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            currentTab = tabName;
        }

        // Alterna automaticamente entre as abas
        function autoSwitchTabs() {
            currentTab = currentTab === "embarquesPA" ? "embarquesFabrica" : "embarquesPA";
            showTab(currentTab);
        }

        // Ativa/desativa alternância automática de abas
        function toggleTimer() {
            timerActive = !timerActive;
            const button = document.querySelector('.toggle-timer');
            button.classList.toggle('active', timerActive);
            button.innerText = timerActive ? "Desativar Alternância Automática" : "Ativar Alternância Automática";

            if (timerActive) {
                timerInterval = setInterval(autoSwitchTabs, 10000); // Muda as abas a cada 10 segundos
            } else {
                clearInterval(timerInterval);
            }
        }

        // Inicialização da página
        window.onload = function () {
            fetchData();                         // Carrega dados iniciais
            showTab('embarquesPA');             // Mostra aba inicial
            setInterval(fetchData, 5000);        // Atualiza dados a cada 5 segundos
        };
    </script>
</head>
<body>
    <h1>Tracking Board Outbound</h1>
    <div id="timer">Próxima atualização em: 5s</div>
    <div class="tab-buttons">
        <button class="tab-button active" onclick="showTab('embarquesPA')">EMBARQUES PA</button>
        <button class="tab-button" onclick="showTab('embarquesFabrica')">EMBARQUES FÁBRICA</button>
        <button class="toggle-timer" onclick="toggleTimer()">Ativar mudança de aba</button>
    </div>
    <div id="embarquesPA" class="tab-content">
        <table id="tablePA"></table>
    </div>
    <div id="embarquesFabrica" class="tab-content">
        <table id="tableFabrica"></table>
    </div>
</body>
</html>
